# Zotero MCP æ’ä»¶åŠŸèƒ½æŒ‡å—

## 1. åŠŸèƒ½æ¦‚è¿°

Zotero MCP (Model-Context-Protocol) æ’ä»¶æ—¨åœ¨å°†æ‚¨çš„ Zotero æ–‡çŒ®åº“è½¬å˜ä¸ºä¸€ä¸ªåŠ¨æ€ã€å¯ç¼–ç¨‹çš„çŸ¥è¯†åº“ã€‚å®ƒé€šè¿‡åœ¨ Zotero å†…éƒ¨è¿è¡Œä¸€ä¸ªè½»é‡çº§çš„æœ¬åœ° HTTP æœåŠ¡å™¨ï¼Œæš´éœ²ä¸€å¥—å®‰å…¨çš„ APIï¼Œå…è®¸å¤–éƒ¨åº”ç”¨ç¨‹åºï¼ˆå¦‚ AI åŠ©æ‰‹ã€è‡ªåŠ¨åŒ–è„šæœ¬ç­‰ï¼‰æŸ¥è¯¢å’Œæ£€ç´¢æ‚¨çš„æ–‡çŒ®æ•°æ®ã€‚

å…¶æ ¸å¿ƒç†å¿µæ˜¯â€œæ‹‰å–æ¨¡å‹â€ï¼šæ’ä»¶åœ¨åå°é™é»˜è¿è¡Œï¼Œç­‰å¾…å¤–éƒ¨æŒ‡ä»¤ï¼Œè€Œä¸æ˜¯ç”±ç”¨æˆ·æ‰‹åŠ¨æ¨é€æ•°æ®ã€‚è¿™ä½¿å¾— Zotero èƒ½å¤Ÿæ— ç¼é›†æˆåˆ°æ›´å¹¿æ³›çš„è‡ªåŠ¨åŒ–å·¥ä½œæµä¸­ã€‚

## 2. å®‰è£…ä¸é…ç½®

### å®‰è£…

è¯¦ç»†çš„æ„å»ºå’Œå®‰è£…æ­¥éª¤ï¼Œè¯·å‚è€ƒé¡¹ç›®ä¸­çš„ [`BUILD_AND_INSTALL.md`](BUILD_AND_INSTALL.md) æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶æä¾›äº†ä»æºç æ„å»ºæ’ä»¶åˆ°åœ¨ Zotero ä¸­æˆåŠŸå®‰è£…çš„å®Œæ•´æŒ‡å—ã€‚

### é…ç½®

å®‰è£…å¹¶é‡å¯ Zotero åï¼Œæ‚¨å¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®æ‰¾åˆ°æ’ä»¶çš„é…ç½®ç•Œé¢ï¼š

- **Windows/Linux:** `ç¼–è¾‘` -> `è®¾ç½®`
- **macOS:** `Zotero` -> `è®¾ç½®`

åœ¨æ‰“å¼€çš„çª—å£ä¸­ï¼Œæ‰¾åˆ°åä¸º "Zotero MCP Plugin" çš„è®¾ç½®åŒºåŸŸã€‚

#### å¯ç”¨é€‰é¡¹

- **å¯ç”¨ MCP æœåŠ¡å™¨ (Enable MCP Server):**
  - **ä½œç”¨:** è¿™æ˜¯æ’ä»¶çš„æ€»å¼€å…³ã€‚å‹¾é€‰æ­¤é¡¹åï¼ŒHTTP æœåŠ¡å™¨å°†åœ¨ Zotero å¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œã€‚å–æ¶ˆå‹¾é€‰åˆ™ä¼šå…³é—­æœåŠ¡å™¨ï¼Œæ‰€æœ‰ API å°†ä¸å¯ç”¨ã€‚
  - **é»˜è®¤å€¼:** ç¦ç”¨ã€‚

- **æœåŠ¡å™¨ç«¯å£ (Server Port):**
  - **ä½œç”¨:** æŒ‡å®š HTTP æœåŠ¡å™¨ç›‘å¬çš„ç«¯å£å·ã€‚åªæœ‰æ¥è‡ªæœ¬æœº (`localhost`) çš„è¯·æ±‚æ‰èƒ½è®¿é—®æ­¤ç«¯å£ã€‚
  - **é»˜è®¤å€¼:** `23120`
  - **æ³¨æ„:** å¦‚æœæ­¤ç«¯å£ä¸æ‚¨è®¡ç®—æœºä¸Šçš„å…¶ä»–åº”ç”¨ç¨‹åºå†²çªï¼Œæ‚¨å¯ä»¥ä¿®æ”¹ä¸º `1024` åˆ° `65535` ä¹‹é—´çš„ä»»ä½•å¯ç”¨ç«¯å£ã€‚

- **é»˜è®¤è¿”å›å­—æ®µ (Default Return Fields):**
  - **ä½œç”¨:** å½“æ‚¨ä½¿ç”¨ `/search` ç«¯ç‚¹ä¸”æœªæ˜ç¡®æŒ‡å®š `fields` å‚æ•°æ—¶ï¼ŒAPI å°†é»˜è®¤è¿”å›æ­¤å¤„å‹¾é€‰çš„å­—æ®µã€‚è¿™å¯ä»¥å¸®åŠ©æ‚¨åœ¨å¸¸è§„æŸ¥è¯¢ä¸­å‡å°‘ä¸å¿…è¦çš„æ•°æ®ä¼ è¾“ï¼Œå®šåˆ¶æœ€å¸¸ç”¨çš„ä¿¡æ¯é›†ã€‚
  - **å¯é€‰å­—æ®µåŒ…æ‹¬:** `title`, `creators`, `year`, `abstract`, `tags`, `doi`, `isbn`, **`attachmentPaths` (é™„ä»¶è·¯å¾„)** ç­‰ã€‚
  - **é»˜è®¤å‹¾é€‰:** `title`, `creators`, `year`ã€‚
  - **åŸºç¡€å­—æ®µ:** `key`, `itemType`, `date`, `zoteroUrl` æ€»æ˜¯ä¼šåŒ…å«åœ¨è¿”å›ç»“æœä¸­ï¼Œæ— è®ºæ˜¯å¦å‹¾é€‰ã€‚

## 3. API ç«¯ç‚¹è¯¦è§£

### `/ping`

- **ç”¨é€”:** å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼Œç”¨äºéªŒè¯ MCP æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œå¹¶èƒ½å¤Ÿå“åº”è¯·æ±‚ã€‚
- **æ–¹æ³•:** `GET`
- **å“åº” (200 OK):**
  ```json
  {
    "message": "pong",
    "timestamp": "2024-08-11T10:25:00.000Z"
  }
  ```
- **ç¤ºä¾‹:**
  ```bash
  curl http://localhost:23120/ping
  ```

### `/search`

- **ç”¨é€”:** åœ¨æ‚¨çš„ Zotero æ–‡çŒ®åº“ä¸­æ‰§è¡Œæœç´¢ã€‚è¿™æ˜¯æ’ä»¶æœ€æ ¸å¿ƒçš„åŠŸèƒ½ã€‚
- **æ–¹æ³•:** `GET`

#### åŸºç¡€æŸ¥è¯¢å‚æ•°

| å‚æ•°       | ç±»å‹   | æ˜¯å¦å¯é€‰ | æè¿°                                                               |
| :--------- | :----- | :------- | :----------------------------------------------------------------- |
| `q`        | string | å¯é€‰     | é€šç”¨æœç´¢å…³é”®è¯ï¼Œåœ¨æ‰€æœ‰å¯æœç´¢å­—æ®µä¸­è¿›è¡Œæ¨¡ç³ŠåŒ¹é…ã€‚                   |
| `title`    | string | å¯é€‰     | æŒ‰æ ‡é¢˜æœç´¢ï¼Œæ”¯æŒæ¨¡ç³ŠåŒ¹é…ã€‚                                         |
| `key`      | string | å¯é€‰     | é€šè¿‡æ¡ç›® `key` è¿›è¡Œç²¾ç¡®åŒ¹é…ï¼Œè¿”å›å•ä¸ªæ¡ç›®çš„è¯¦ç»†ä¿¡æ¯ã€‚              |
| `tags`     | string | å¯é€‰     | æ ¹æ®æ ‡ç­¾è¿›è¡Œç­›é€‰ã€‚å¤šä¸ªæ ‡ç­¾å¯ä»¥ç”¨é€—å· `,` åˆ†éš”ã€‚                    |
| `tagMode`  | string | å¯é€‰     | æ ‡ç­¾åŒ¹é…æ¨¡å¼ (`any`, `all`, `none`)ï¼Œé»˜è®¤ä¸º `any`ã€‚                |
| `tagMatch` | string | å¯é€‰     | æ ‡ç­¾åŒ¹é…æ–¹å¼ (`exact`, `contains`, `startsWith`)ï¼Œé»˜è®¤ä¸º `exact`ã€‚ |

#### é«˜çº§æœç´¢å‚æ•°

| å‚æ•°               | ç±»å‹   | æ˜¯å¦å¯é€‰ | æè¿°                                                                        |
| :----------------- | :----- | :------- | :-------------------------------------------------------------------------- |
| `titleOperator`    | string | å¯é€‰     | æ ‡é¢˜æœç´¢æ“ä½œç¬¦ (`contains`, `exact`, `startsWith`, `endsWith`, `regex`)ã€‚   |
| `yearRange`        | string | å¯é€‰     | å¹´ä»½èŒƒå›´è¿‡æ»¤ï¼Œæ ¼å¼: `2020-2023`ã€‚                                          |
| `dateRange`        | string | å¯é€‰     | æ—¥æœŸèŒƒå›´è¿‡æ»¤ï¼Œæ ¼å¼: `2023-01-01,2023-12-31`ã€‚                              |
| `relevanceScoring` | string | å¯é€‰     | å¯ç”¨ç›¸å…³æ€§è¯„åˆ† (`true`/`false`)ï¼Œé»˜è®¤ä¸º `false`ã€‚                           |
| `boostFields`      | string | å¯é€‰     | æå‡å­—æ®µæƒé‡ï¼Œæ ¼å¼: `title:2.0,abstract:1.5` (é€—å·åˆ†éš”)ã€‚                  |
| `sort`             | string | å¯é€‰     | æ’åºæ–¹å¼ (`relevance`, `date`, `title`, `year`)ï¼Œé»˜è®¤ä¸º `relevance`ã€‚       |
| `direction`        | string | å¯é€‰     | æ’åºæ–¹å‘ (`asc`/`desc`)ï¼Œé»˜è®¤ä¸º `desc`ã€‚                                    |

## 4. å“åº”æ ¼å¼

API æ ¹æ®æŸ¥è¯¢å‚æ•°è¿”å›ä¸¤ç§ä¸åŒè¯¦ç»†ç¨‹åº¦çš„ JSON æ ¼å¼ã€‚

#### a) æ ¸å¿ƒä¿¡æ¯æ ¼å¼ (é»˜è®¤)

å½“è¿›è¡Œå…¨æ–‡ã€æ ‡é¢˜ç­‰å¸¸è§„æœç´¢æ—¶è¿”å›ã€‚æ­¤æ ¼å¼ä¸ºæ•°ç»„ï¼ŒåŒ…å«æ ¸å¿ƒä¿¡æ¯ï¼Œå“åº”é€Ÿåº¦å¿«ã€‚

- **è¯·æ±‚ç¤ºä¾‹ (é€šç”¨æœç´¢):**
  ```bash
  curl "http://localhost:23120/search?q=æœºå™¨å­¦ä¹ "
  ```
- **å“åº”ç¤ºä¾‹ (æ ¸å¿ƒä¿¡æ¯):**
  ```json
  {
    "query": {
      "q": "æœºå™¨å­¦ä¹ "
    },
    "pagination": {
      "limit": 100,
      "offset": 0,
      "total": 1,
      "hasMore": false
    },
    "searchTime": "50ms",
    "results": [
      {
        "key": "ABCDEFGH",
        "title": "æ·±åº¦å­¦ä¹ åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ä¸­çš„åº”ç”¨",
        "creators": "å¼ ä¸‰, æå››",
        "date": "2023"
      }
    ]
  }
  ```

#### b) è¯¦ç»†ä¿¡æ¯æ ¼å¼ (ä½¿ç”¨ `key` æŸ¥è¯¢)

å½“ä½¿ç”¨ `key` å‚æ•°è¿›è¡Œç²¾ç¡®æŸ¥è¯¢æ—¶è¿”å›ã€‚æ­¤æ ¼å¼ä¸ºæ•°ç»„ï¼ŒåŒ…å«æ¡ç›®çš„å®Œæ•´ä¿¡æ¯ã€‚

- **è¯·æ±‚ç¤ºä¾‹ (æŒ‰ Key ç²¾ç¡®æŸ¥è¯¢):**
  ```bash
  curl "http://localhost:23120/search?key=ABCDEFGH"
  ```
- **å“åº”ç¤ºä¾‹ (è¯¦ç»†ä¿¡æ¯):**
  ```json
  {
    "query": {
      "key": "ABCDEFGH"
    },
    "pagination": {
      "limit": 1,
      "offset": 0,
      "total": 1,
      "hasMore": false
    },
    "searchTime": "15ms",
    "results": [
      {
        "key": "ABCDEFGH",
        "itemType": "journalArticle",
        "zoteroUrl": "zotero://select/library/items/ABCDEFGH",
        "title": "æ·±åº¦å­¦ä¹ åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ä¸­çš„åº”ç”¨",
        "creators": [
          { "firstName": "ä¸‰", "lastName": "å¼ ", "creatorType": "author" },
          { "firstName": "å››", "lastName": "æ", "creatorType": "author" }
        ],
        "date": "2023-10-01",
        "abstractNote": "æœ¬æ–‡æ¢è®¨äº†æ·±åº¦å­¦ä¹ æ¨¡å‹åœ¨æœºå™¨ç¿»è¯‘ã€æƒ…æ„Ÿåˆ†æç­‰é¢†åŸŸçš„æœ€æ–°è¿›å±•...",
        "attachments": [
          {
            "title": "å…¨æ–‡PDF",
            "path": "C:/Zotero/storage/ABCDEFGH/å®Œæ•´è®ºæ–‡.pdf",
            "contentType": "application/pdf",
            "filename": "å®Œæ•´è®ºæ–‡.pdf"
          }
        ],
        "tags": ["æ·±åº¦å­¦ä¹ ", "NLP"]
      }
    ]
  }
  ```

## 5. ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€æœç´¢ç¤ºä¾‹

**1. é€šç”¨æœç´¢**
åœ¨æ‰€æœ‰å­—æ®µä¸­æœç´¢åŒ…å«"æœºå™¨å­¦ä¹ "çš„æ¡ç›®ã€‚

```bash
curl "http://localhost:23120/search?q=æœºå™¨å­¦ä¹ "
```

**2. æŒ‰æ ‡é¢˜æœç´¢**
æœç´¢æ ‡é¢˜ä¸­åŒ…å«"ä»·å€¼å…±åˆ›"çš„æ¡ç›®ã€‚

```bash
curl "http://localhost:23120/search?title=ä»·å€¼å…±åˆ›"
```

**3. æŒ‰ Key ç²¾ç¡®æŸ¥è¯¢**
è·å– Key ä¸º `ABC123` çš„æ¡ç›®çš„è¯¦ç»†ä¿¡æ¯ã€‚

```bash
curl "http://localhost:23120/search?key=ABC123"
```

### é«˜çº§æœç´¢ç¤ºä¾‹

**4. ç²¾ç¡®æ ‡é¢˜åŒ¹é…**
æŸ¥æ‰¾æ ‡é¢˜å®Œå…¨åŒ¹é…çš„æ¡ç›®ã€‚

```bash
curl "http://localhost:23120/search?title=æ·±åº¦å­¦ä¹ åŸç†ä¸åº”ç”¨&titleOperator=exact"
```

**5. å¹´ä»½èŒƒå›´æœç´¢**
æœç´¢2020-2023å¹´é—´å‘è¡¨çš„æ–‡çŒ®ã€‚

```bash
curl "http://localhost:23120/search?yearRange=2020-2023&sort=year&direction=desc"
```

**6. å¯ç”¨ç›¸å…³æ€§è¯„åˆ†**
ä½¿ç”¨ç›¸å…³æ€§è¯„åˆ†æœç´¢ï¼Œå¹¶æå‡æ ‡é¢˜æƒé‡ã€‚

```bash
curl "http://localhost:23120/search?q=äººå·¥æ™ºèƒ½&relevanceScoring=true&boostFields=title:2.0,abstract:1.5&sort=relevance"
```

**7. æ­£åˆ™è¡¨è¾¾å¼æœç´¢**
ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ ‡é¢˜ã€‚

```bash
curl "http://localhost:23120/search?title=^æ·±åº¦.*å­¦ä¹ $&titleOperator=regex"
```

**8. æ—¥æœŸèŒƒå›´è¿‡æ»¤**
æœç´¢ç‰¹å®šæ—¥æœŸèŒƒå›´å†…çš„æ–‡çŒ®ã€‚

```bash
curl "http://localhost:23120/search?dateRange=2023-01-01,2023-12-31&sort=date&direction=desc"
```

#### å¢å¼ºçš„ Tags æœç´¢åŠŸèƒ½

- **`tags`**:
  - **åŠŸèƒ½**: ç­›é€‰åŒ…å«ç‰¹å®šæ ‡ç­¾çš„æ¡ç›®ã€‚
  - **ç¤ºä¾‹**: `tags=æ·±åº¦å­¦ä¹ ,NLP` (æŸ¥æ‰¾åŒæ—¶åŒ…å«â€œæ·±åº¦å­¦ä¹ â€å’Œâ€œNLPâ€çš„æ¡ç›®)

- **`tagMode`**:
  - **åŠŸèƒ½**: å®šä¹‰å¤šä¸ªæ ‡ç­¾çš„åŒ¹é…é€»è¾‘ã€‚
  - **`any` (é»˜è®¤)**: åŒ…å«**ä»»æ„**ä¸€ä¸ªæŒ‡å®šæ ‡ç­¾å³å¯ã€‚
  - **`all`**: å¿…é¡»åŒ…å«**æ‰€æœ‰**æŒ‡å®šçš„æ ‡ç­¾ã€‚
  - **`none`**: **ä¸èƒ½åŒ…å«**ä»»ä½•æŒ‡å®šçš„æ ‡ç­¾ã€‚
  - **ç¤ºä¾‹**: `tags=AI,GPT&tagMode=all`

- **`tagMatch`**:
  - **åŠŸèƒ½**: å®šä¹‰æ ‡ç­¾çš„åŒ¹é…æ–¹å¼ã€‚
  - **`exact` (é»˜è®¤)**: ç²¾ç¡®åŒ¹é…æ•´ä¸ªæ ‡ç­¾ã€‚
  - **`contains`**: æ ‡ç­¾ååŒ…å«æŸ¥è¯¢è¯å³å¯ã€‚
  - **`startsWith`**: æ ‡ç­¾åä»¥æŸ¥è¯¢è¯å¼€å¤´ã€‚
  - **ç¤ºä¾‹**: `tags=å­¦ä¹ &tagMatch=contains` (ä¼šåŒ¹é…â€œæ·±åº¦å­¦ä¹ â€ã€â€œæœºå™¨å­¦ä¹ â€ç­‰)

### PDF æ–‡æœ¬æå– API

#### `GET /items/:itemKey/pdf-content`

- **ç”¨é€”**: ä»æŒ‡å®šæ¡ç›®çš„ PDF é™„ä»¶ä¸­æå–æ–‡æœ¬å†…å®¹ã€‚å¦‚æœä¸€ä¸ªæ¡ç›®æœ‰å¤šä¸ª PDF é™„ä»¶ï¼Œé»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ªã€‚
- **æ–¹æ³•**: `GET`
- **è·¯å¾„å‚æ•°**:
  - `:itemKey` (string, required): Zotero ä¸­æ¡ç›®çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚

##### æŸ¥è¯¢å‚æ•°

| å‚æ•°     | ç±»å‹   | æ˜¯å¦å¯é€‰ | æè¿°                                                                            |
| :------- | :----- | :------- | :------------------------------------------------------------------------------ |
| `page`   | number | å¯é€‰     | æŒ‡å®šè¦æå–æ–‡æœ¬çš„ PDF é¡µç ï¼ˆä» 1 å¼€å§‹ï¼‰ã€‚å¦‚æœçœç•¥ï¼Œåˆ™æå–æ‰€æœ‰é¡µé¢çš„æ–‡æœ¬ã€‚        |
| `format` | string | å¯é€‰     | å®šä¹‰è¿”å›å†…å®¹çš„æ ¼å¼ã€‚æ”¯æŒ `text` (é»˜è®¤ï¼Œè¿”å›çº¯æ–‡æœ¬) å’Œ `json` (è¿”å›ç»“æ„åŒ–æ•°æ®)ã€‚ |

##### å“åº”æ ¼å¼ç¤ºä¾‹ (`format=json`)

```json
{
  "itemKey": "ABCDEFGH",
  "totalPages": 15,
  "pages": [
    {
      "page": 1,
      "content": "è¿™æ˜¯ç¬¬ä¸€é¡µçš„æ–‡æœ¬å†…å®¹..."
    }
  ]
}
```

##### ä½¿ç”¨ç¤ºä¾‹

**1. è·å– PDF å…¨æ–‡ (é»˜è®¤æ–‡æœ¬æ ¼å¼)**

```bash
curl "http://localhost:23120/items/ABCDEFGH/pdf-content"
```

**2. è·å–ç¬¬ 5 é¡µçš„æ–‡æœ¬**

```bash
curl "http://localhost:23120/items/ABCDEFGH/pdf-content?page=5"
```

**3. ä»¥ JSON æ ¼å¼è·å–ç¬¬ 1 é¡µçš„å†…å®¹**

```bash
curl "http://localhost:23120/items/ABCDEFGH/pdf-content?page=1&format=json"
```

##### æŠ€æœ¯å®ç°è¯´æ˜

- **æ ¸å¿ƒå¼•æ“**: è¯¥åŠŸèƒ½åˆ©ç”¨ Zotero å†…ç½®çš„ `pdfWorker` æ¥è§£æ PDF æ–‡ä»¶ï¼Œç¡®ä¿äº†é«˜æ•ˆå’Œå…¼å®¹æ€§ã€‚
- **å¼‚æ­¥å¤„ç†**: æ–‡æœ¬æå–æ˜¯ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹ï¼Œä¸ä¼šé˜»å¡ Zotero çš„ä¸»çº¿ç¨‹ï¼Œä¿è¯äº†ç”¨æˆ·ç•Œé¢çš„æµç•…ã€‚
- **é”™è¯¯å¤„ç†**: å¦‚æœæ¡ç›®æ²¡æœ‰ PDF é™„ä»¶ã€PDF æŸåæˆ–é¡µç æ— æ•ˆï¼ŒAPI ä¼šè¿”å›ç›¸åº”çš„é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚ 404 Not Found æˆ– 400 Bad Requestï¼‰ã€‚

##### API æµ‹è¯•è¯´æ˜

æ‚¨å¯ä»¥é€šè¿‡è®¿é—® `http://localhost:23120/api-test` é¡µé¢æ¥æ–¹ä¾¿åœ°æµ‹è¯•æ­¤åŠŸèƒ½ã€‚åœ¨æµ‹è¯•é¡µé¢ä¸­ï¼Œè¾“å…¥ `itemKey` å¹¶é€‰æ‹© `pdf-content` å³å¯è¿›è¡Œäº¤äº’å¼æµ‹è¯•ã€‚

### Collections API

#### `GET /collections`

- **åŠŸèƒ½æè¿°**: è·å– Zotero æ–‡çŒ®åº“ä¸­æ‰€æœ‰ collections çš„å±‚çº§åˆ—è¡¨ã€‚
- **è¯·æ±‚å‚æ•°**: æ— 
- **å“åº”æ ¼å¼ç¤ºä¾‹**:
  ```json
  [
    {
      "key": "COLLECTION_KEY_1",
      "name": "è®¡ç®—æœºç§‘å­¦",
      "level": 0,
      "children": [
        {
          "key": "COLLECTION_KEY_2",
          "name": "äººå·¥æ™ºèƒ½",
          "level": 1,
          "children": []
        }
      ]
    }
  ]
  ```
- **ä½¿ç”¨ç¤ºä¾‹**:
  ```bash
  curl http://localhost:23120/collections
  ```

#### `GET /collections/search`

- **åŠŸèƒ½æè¿°**: æ ¹æ®åç§°æœç´¢ collectionsã€‚
- **è¯·æ±‚å‚æ•°**:
  - `q` (string, required): æœç´¢å…³é”®è¯ã€‚
- **å“åº”æ ¼å¼ç¤ºä¾‹**:
  ```json
  [
    {
      "key": "COLLECTION_KEY_2",
      "name": "äººå·¥æ™ºèƒ½"
    }
  ]
  ```
- **ä½¿ç”¨ç¤ºä¾‹**:
  ```bash
  curl "http://localhost:23120/collections/search?q=äººå·¥æ™ºèƒ½"
  ```

#### `GET /collections/:collectionKey`

- **åŠŸèƒ½æè¿°**: è·å–å•ä¸ª collection çš„è¯¦ç»†ä¿¡æ¯ã€‚
- **è¯·æ±‚å‚æ•°**:
  - `:collectionKey` (string, required): Collection çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚
- **å“åº”æ ¼å¼ç¤ºä¾‹**:
  ```json
  {
    "key": "COLLECTION_KEY_2",
    "name": "äººå·¥æ™ºèƒ½",
    "parent": "COLLECTION_KEY_1",
    "numberOfItems": 50
  }
  ```
- **ä½¿ç”¨ç¤ºä¾‹**:
  ```bash
  curl http://localhost:23120/collections/COLLECTION_KEY_2
  ```

#### `GET /collections/:collectionKey/items`

- **åŠŸèƒ½æè¿°**: è·å–æŒ‡å®š collection ä¸‹çš„æ‰€æœ‰æ–‡çŒ®æ¡ç›®ã€‚
- **è¯·æ±‚å‚æ•°**:
  - `:collectionKey` (string, required): Collection çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚
- **å“åº”æ ¼å¼ç¤ºä¾‹**: (ä¸ `/search` çš„æ ¸å¿ƒä¿¡æ¯æ ¼å¼ç›¸åŒ)
  ```json
  {
    "results": [
      {
        "key": "ITEM_KEY_1",
        "title": "A brief history of AI",
        ...
      }
    ]
  }
  ```
- **ä½¿ç”¨ç¤ºä¾‹**:

  ```bash
  curl http://localhost:23120/collections/COLLECTION_KEY_2/items
  ```

### æ³¨é‡Šå’Œç¬”è®°æ£€ç´¢ API

#### `GET /annotations/search`

- **åŠŸèƒ½æè¿°**: æœç´¢ Zotero æ–‡çŒ®åº“ä¸­çš„æ‰€æœ‰ç¬”è®°ã€PDF æ³¨é‡Šå’Œé«˜äº®å†…å®¹ã€‚
- **æ–¹æ³•**: `GET`

##### æŸ¥è¯¢å‚æ•°

| å‚æ•°         | ç±»å‹    | æ˜¯å¦å¯é€‰ | æè¿°                                                                          |
| :----------- | :------ | :------- | :---------------------------------------------------------------------------- |
| `q`          | string  | å¯é€‰     | æœç´¢å…³é”®è¯ï¼ˆåœ¨å†…å®¹ã€è¯„è®ºã€æ ‡ç­¾ä¸­æœç´¢ï¼‰ã€‚                                      |
| `type`       | string  | å¯é€‰     | æ³¨é‡Šç±»å‹è¿‡æ»¤ (`note`, `highlight`, `annotation`, `ink`, `text`, `image`)ã€‚    |
| `tags`       | string  | å¯é€‰     | æ ‡ç­¾è¿‡æ»¤ï¼ˆé€—å·åˆ†éš”ï¼‰ã€‚                                                        |
| `color`      | string  | å¯é€‰     | é¢œè‰²è¿‡æ»¤ï¼ˆé€‚ç”¨äºé«˜äº®ï¼‰ã€‚                                                      |
| `hasComment` | boolean | å¯é€‰     | æ˜¯å¦æœ‰è¯„è®º (`true`/`false`)ã€‚                                                 |
| `dateRange`  | string  | å¯é€‰     | æ—¥æœŸèŒƒå›´ (`2023-01-01,2023-12-31`)ã€‚                                         |
| `itemKey`    | string  | å¯é€‰     | é™åˆ¶åˆ°ç‰¹å®šæ–‡çŒ®ã€‚                                                              |
| `sort`       | string  | å¯é€‰     | æ’åºæ–¹å¼ (`dateAdded`, `dateModified`, `position`)ï¼Œé»˜è®¤ä¸º `dateModified`ã€‚   |
| `direction`  | string  | å¯é€‰     | æ’åºæ–¹å‘ (`asc`/`desc`)ï¼Œé»˜è®¤ä¸º `desc`ã€‚                                      |
| `limit`      | string  | å¯é€‰     | ç»“æœæ•°é‡é™åˆ¶ï¼ˆæœ€å¤§ 200ï¼‰ï¼Œé»˜è®¤ä¸º 50ã€‚                                         |
| `offset`     | string  | å¯é€‰     | åˆ†é¡µåç§»é‡ï¼Œé»˜è®¤ä¸º 0ã€‚                                                        |

##### å“åº”æ ¼å¼ç¤ºä¾‹

```json
{
  "results": [
    {
      "id": "ABCD1234",
      "itemKey": "ABCD1234",
      "parentKey": "EFGH5678",
      "type": "highlight",
      "content": "è¿™æ˜¯é‡è¦çš„å†…å®¹",
      "text": "åŸå§‹é«˜äº®æ–‡æœ¬",
      "comment": "æˆ‘çš„è¯„è®º",
      "color": "yellow",
      "tags": ["é‡è¦", "ç†è®º"],
      "dateAdded": "2023-01-01T12:00:00.000Z",
      "dateModified": "2023-01-02T12:00:00.000Z",
      "page": 15,
      "sortIndex": 100
    }
  ],
  "pagination": {
    "limit": 20,
    "offset": 0,
    "total": 150,
    "hasMore": true
  },
  "searchTime": "45ms",
  "totalCount": 150
}
```

##### ä½¿ç”¨ç¤ºä¾‹

**1. æœç´¢åŒ…å«ç‰¹å®šå…³é”®è¯çš„é«˜äº®**
```bash
curl "http://localhost:23120/annotations/search?q=æœºå™¨å­¦ä¹ &type=highlight&limit=10"
```

**2. è·å–å¸¦è¯„è®ºçš„æ³¨é‡Š**
```bash
curl "http://localhost:23120/annotations/search?hasComment=true&sort=dateModified&direction=desc"
```

**3. æœç´¢ç‰¹å®šé¢œè‰²çš„é«˜äº®**
```bash
curl "http://localhost:23120/annotations/search?type=highlight&color=red&limit=20"
```

#### `GET /items/:itemKey/notes`

- **åŠŸèƒ½æè¿°**: è·å–ç‰¹å®šæ–‡çŒ®çš„æ‰€æœ‰ç¬”è®°å†…å®¹ã€‚
- **æ–¹æ³•**: `GET`
- **è·¯å¾„å‚æ•°**:
  - `:itemKey` (string, required): æ–‡çŒ®çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚

##### å“åº”æ ¼å¼ç¤ºä¾‹

```json
[
  {
    "id": "NOTE123",
    "itemKey": "NOTE123",
    "parentKey": "ITEM456",
    "type": "note",
    "content": "<p>è¿™æ˜¯ä¸€æ¡ç¬”è®°</p>",
    "text": "è¿™æ˜¯ä¸€æ¡ç¬”è®°",
    "tags": ["é‡è¦"],
    "dateAdded": "2023-01-01T12:00:00.000Z",
    "dateModified": "2023-01-02T12:00:00.000Z"
  }
]
```

##### ä½¿ç”¨ç¤ºä¾‹

```bash
curl "http://localhost:23120/items/ABCD1234/notes"
```

#### `GET /items/:itemKey/annotations`

- **åŠŸèƒ½æè¿°**: è·å–ç‰¹å®šæ–‡çŒ®PDFä¸­çš„æ³¨é‡Šå’Œé«˜äº®ï¼Œæ”¯æŒç±»å‹å’Œé¢œè‰²è¿‡æ»¤ã€‚
- **æ–¹æ³•**: `GET`
- **è·¯å¾„å‚æ•°**:
  - `:itemKey` (string, required): æ–‡çŒ®çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚

##### æŸ¥è¯¢å‚æ•°

| å‚æ•°     | ç±»å‹   | æ˜¯å¦å¯é€‰ | æè¿°                                                                       |
| :------- | :----- | :------- | :------------------------------------------------------------------------- |
| `type`   | string | å¯é€‰     | æ³¨é‡Šç±»å‹è¿‡æ»¤ (`highlight`, `annotation`, `ink`, `text`, `image`)ã€‚         |
| `color`  | string | å¯é€‰     | é¢œè‰²è¿‡æ»¤ï¼ˆé€‚ç”¨äºé«˜äº®ï¼‰ã€‚                                                   |

##### å“åº”æ ¼å¼ç¤ºä¾‹

ä¸ `/annotations/search` çš„æ ¼å¼ç›¸åŒï¼Œä½†ç»“æœå·²æŒ‰é¡µé¢ä½ç½®æ’åºã€‚

##### ä½¿ç”¨ç¤ºä¾‹

```bash
curl "http://localhost:23120/items/ABCD1234/annotations?type=highlight&color=yellow"
```

#### `GET /test/annotations`

- **åŠŸèƒ½æè¿°**: è¿è¡Œæ³¨é‡ŠåŠŸèƒ½çš„å®Œæ•´æµ‹è¯•å¥—ä»¶ã€‚
- **æ–¹æ³•**: `GET`

##### å“åº”æ ¼å¼ç¤ºä¾‹

```json
{
  "message": "Annotation features test completed",
  "message_zh": "æ³¨é‡ŠåŠŸèƒ½æµ‹è¯•å®Œæˆ",
  "testResults": {
    "summary": {
      "total": 5,
      "passed": 5,
      "failed": 0,
      "successRate": "100.0%"
    },
    "tests": [
      {
        "name": "è·å–æ‰€æœ‰ç¬”è®°",
        "status": "PASSED",
        "duration": 253,
        "resultCount": 2001,
        "totalCount": 2001
      }
    ],
    "timestamp": "2024-01-01T12:00:00.000Z"
  }
}
```

##### ä½¿ç”¨ç¤ºä¾‹

```bash
curl "http://localhost:23120/test/annotations"
```

### é«˜çº§æœç´¢æµ‹è¯• API

#### `GET /test/advanced-search`

- **åŠŸèƒ½æè¿°**: è¿è¡Œé«˜çº§æœç´¢åŠŸèƒ½çš„å®Œæ•´æµ‹è¯•å¥—ä»¶ã€‚
- **æ–¹æ³•**: `GET`

##### å“åº”æ ¼å¼ç¤ºä¾‹

```json
{
  "message": "Advanced search features test completed",
  "message_zh": "é«˜çº§æœç´¢åŠŸèƒ½æµ‹è¯•å®Œæˆ",
  "testResults": {
    "summary": {
      "total": 12,
      "passed": 12,
      "failed": 0,
      "successRate": "100.0%"
    },
    "tests": [
      {
        "name": "åŸºç¡€æœç´¢åŠŸèƒ½",
        "status": "PASSED",
        "duration": 45,
        "resultCount": 10
      }
    ]
  }
}
```

##### ä½¿ç”¨ç¤ºä¾‹

```bash
curl "http://localhost:23120/test/advanced-search"
```

## 6. ç‰ˆæœ¬æ›´æ–°è¯´æ˜

### v2.0 ä¸»è¦æ›´æ–°

- **ğŸš€ é«˜çº§æœç´¢åŠŸèƒ½:**
  - æ–°å¢é«˜çº§æœç´¢å‚æ•° (`titleOperator`, `yearRange`, `dateRange`, `relevanceScoring`, `boostFields`)
  - æ”¯æŒç²¾ç¡®åŒ¹é…ã€æ­£åˆ™è¡¨è¾¾å¼ã€å‰ç¼€åŒ¹é…ç­‰å¤šç§æœç´¢æ“ä½œç¬¦
  - å¼•å…¥ç›¸å…³æ€§è¯„åˆ†ç³»ç»Ÿå’Œå­—æ®µæƒé‡æå‡åŠŸèƒ½
  - æ–°å¢å¹´ä»½èŒƒå›´å’Œæ—¥æœŸèŒƒå›´è¿‡æ»¤åŠŸèƒ½
  - æ”¯æŒçµæ´»çš„æ’åºå’Œåˆ†é¡µæœºåˆ¶

- **ğŸ“š æ³¨é‡Šå’Œç¬”è®°æ£€ç´¢ç³»ç»Ÿ:**
  - æ–°å¢ `/annotations/search` APIï¼Œæ”¯æŒè·¨ç¬”è®°å’Œæ³¨é‡Šçš„å…¨æ–‡æœç´¢
  - æ–°å¢ `/items/:itemKey/notes` APIï¼Œè·å–ç‰¹å®šæ–‡çŒ®çš„ç¬”è®°å†…å®¹
  - æ–°å¢ `/items/:itemKey/annotations` APIï¼Œè·å–PDFä¸­çš„æ³¨é‡Šå’Œé«˜äº®
  - æ”¯æŒæŒ‰ç±»å‹ã€é¢œè‰²ã€è¯„è®ºã€æ ‡ç­¾ç­‰å¤šç»´åº¦è¿‡æ»¤
  - è‡ªåŠ¨æŒ‰é¡µé¢ä½ç½®æ’åºPDFæ³¨é‡Šï¼Œæä¾›å®Œæ•´çš„é˜…è¯»ä½“éªŒ

- **ğŸ”§ æµ‹è¯•å’Œè°ƒè¯•åŠŸèƒ½:**
  - æ–°å¢ `/test/advanced-search` æµ‹è¯•ç«¯ç‚¹ï¼ŒåŒ…å«12ä¸ªæµ‹è¯•ç”¨ä¾‹
  - æ–°å¢ `/test/annotations` æµ‹è¯•ç«¯ç‚¹ï¼ŒåŒ…å«5ä¸ªæµ‹è¯•ç”¨ä¾‹
  - å®Œæ•´çš„é”™è¯¯å¤„ç†å’ŒUTF-8ç¼–ç æ”¯æŒ
  - è¯¦ç»†çš„æ€§èƒ½ç»Ÿè®¡å’Œæ‰§è¡Œæ—¶é—´è®°å½•

### å†å²ç‰ˆæœ¬æ›´æ–°

- **åŠŸèƒ½å¢å¼º:**
  - æ–°å¢ `/items/:itemKey/pdf-content` APIï¼Œç”¨äºæå– PDF é™„ä»¶çš„æ–‡æœ¬å†…å®¹ã€‚
  - æ–°å¢ Collections APIï¼Œç”¨äºæŸ¥è¯¢å’Œç®¡ç†åˆ†ç±»ã€‚
  - æ–°å¢é«˜çº§ Tags æœç´¢åŠŸèƒ½ (`tagMode`, `tagMatch`)ã€‚
  - **é€»è¾‘ç®€åŒ–:** ç§»é™¤äº† `detail` å‚æ•°ã€‚ç°åœ¨ï¼Œå½“ä½¿ç”¨ `key` è¿›è¡Œç²¾ç¡®æœç´¢æ—¶ï¼ŒAPI ä¼šè‡ªåŠ¨è¿”å›è¯¦ç»†ä¿¡æ¯ï¼›å…¶ä»–æ‰€æœ‰æœç´¢ï¼ˆå¦‚å…¨æ–‡ã€æ ‡é¢˜æœç´¢ï¼‰åˆ™é»˜è®¤è¿”å›æ ¸å¿ƒä¿¡æ¯ã€‚

- **æ€§èƒ½ä¼˜åŒ–:** å¸¸è§„æœç´¢é»˜è®¤è¿”å›æ ¸å¿ƒä¿¡æ¯ï¼Œå¤§å¹…æå‡äº†å¤§è§„æ¨¡æŸ¥è¯¢çš„å“åº”é€Ÿåº¦ã€‚
- **åŠŸèƒ½å¢å¼º:**
  - æ–°å¢é€šè¿‡ `key` è¿›è¡Œç²¾ç¡®æŸ¥æ‰¾çš„åŠŸèƒ½ã€‚
  - `title` å‚æ•°ç°åœ¨æ”¯æŒæ›´çµæ´»çš„æ¨¡ç³ŠåŒ¹é…ã€‚
- **æ•°æ®æ‰©å±•:** å½“è¿›è¡Œç²¾ç¡®åŒ¹é… (`key`) æ—¶ï¼Œå“åº”ä¸­ä¼šè‡ªåŠ¨åŒ…å«é™„ä»¶çš„æœ¬åœ°æ–‡ä»¶è·¯å¾„ (`path`)ã€‚
- **Bugä¿®å¤:** ä¿®å¤äº†åœ¨å¤„ç†æŸäº›å…³é”®è¯æ—¶å¯èƒ½å‡ºç°çš„ UTF-8 ç¼–ç é—®é¢˜ï¼Œç¡®ä¿å…¨çƒè¯­è¨€çš„å…¼å®¹æ€§ã€‚
